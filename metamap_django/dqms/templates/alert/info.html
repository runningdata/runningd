<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>报警信息</title>
<link rel="stylesheet" type="text/css" media="screen" href="css/page/check_manager/index.css" />
<link rel="stylesheet"  href="css/bootstrap-timepicker.css" />
<link rel="stylesheet"  href="css/bootstrap-wysihtml5.css" />
<link rel="stylesheet"  href="css/datepicker.css" />

<!-- Jquery -->
<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="js/jquery-ui.min.js"></script>
<script type="text/javascript" src="js/jquery.jqGrid.min.js"></script>
<script type="text/javascript" src="js/grid.locale-cn.js"></script>
<script language="javascript" src="InValid.js"></script>
<!-- Bootstrap -->
<script src="bootstrap/js/bootstrap.js"></script>

<script>
var PAGE_NUM=1;
var PAGE_ROWS=50;

$(document).ready(function(){
    queryCheckInst(PAGE_NUM,PAGE_ROWS);
});

function queryCheckInst(page,row){
    $.ajax({
        url:'alarm/queryCheckInst',
        type:"get",
        data:"page=" + page+ "&rows=" + row,
        success:function(resp){
            if(resp.code == 1) { //调用服务失败
                $("#checkinst").html(resp.msg);
                $("#failedModal").modal('show');
                return;
            }
            var data = resp.data;
            htmlCheckInstTable(data);
        }
    })

}

/**
 * 查看某一个质检用例实例的ACK信息
 */
function ackCaseInst(caseInstId){
    var params ="caseInstId="+caseInstId;
    window.parent.select_page('alarm_ack', params);

}


/**
 * 显示质检用例的列表
 */
function htmlCheckInstTable(data){
    var check_inst_list_view = "";
    var result = '正确';

    for(i=0;i<data.list.length;i++) {
        result="未响应"
        if(data.list[i].is_ack == 1){
            result = "已响应"
        }
        check_inst_list_view += "<tr>" +
                "<td class='id'>" + data.list[i].id + "</td>" +
                "<td class='name'>" + data.list[i].chkName + "</td>" +
                "<td>" + data.list[i].caseName + "</td>" +
                "<td>" + data.list[i].startTime + "</td>" +
                "<td>" + data.list[i].endTime + "</td>" +
                "<td>" + data.list[i].lastEditor + "</td>" +
                "<td>" + result + "</td>" +
                "<td>" +
                "<button class='btn btn-default btn-xs' onclick=\"ackCaseInst(" + data.list[i].id + ")\">查看ACK</button>" +
                "</td>" +
                "</tr>";
    }

    $("#checkinst_list_table").html(check_inst_list_view);
}

/**
 * 按照模糊的质检用例名称去查询其的用例实例
 * @param page
 * @param rows
 */
function queryCheckInstByName(page,row){
    var chkName = $('#checkname').val();
    $.ajax({
        url:'alarm/queryCheckInst',
        type:"get",
        data:"chkName="+chkName+"&page=" + page+ "&rows=" + row,
        success:function(resp){
            if(resp.code == 1) { //调用服务失败
                $("#checkinst").html(resp.msg);
                $("#failedModal").modal('show');
                return;
            }
            var data = resp.data;
            htmlCheckInstTable(data);
        }
    })
}

</script>
</head>
<body>
<div class="panel-dash">
    <!-- breadcrumb start -->
    <div class="m-search-wrap label-w-100">
        <div></div>
        <div class="m-search-group">
            <label class="m-search-label">质检监控信息</label>
            <div class=" m-search-detail">
                <input type="text" name="name" placeholder="质检名称" id="checkname">
            </div>
            <button type="button" class="btn btn-sm btn-success m-search-btn" id="j-submit"
                    onclick="queryCheckInstByName(PAGE_NUM,PAGE_ROWS)">查询</button>
        </div>
        <div id="j-search-list">
            <p id="totalCheckinst"></p>
            <table class="table table-bordered " style="margin-top: 8px">
                <thead>
                <tr>
                    <th>编号</th>
                    <th>任务名称</th>
                    <th>用例名称</th>
                    <th>开始时间</th>
                    <th>结束时间</th>
                    <th>负责人</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody id="checkinst_list_table"></tbody>
            </table>
        </div>
    </div>

    <!-- 失败弹窗 -->
    <div id="failedModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">失败</h4>
                </div>
                <div class="modal-body">
                    <p id="checkinst">调用服务失败，请联系管理员。</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">确认</button>
                </div>
            </div>
        </div>
    </div>

</div>
    <!-- breadcrumb
</body>
</html>