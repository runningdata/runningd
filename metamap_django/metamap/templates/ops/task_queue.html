{% extends 'layout.html' %}
{% load ifdef %}
{% block title %}队列总体情况{% endblock %}
{% block content %}
    {% if unack|length > 0 %}
        排队中:<br/>
        common : {{ unack | length }} <br/>
        <table>
            <tr>
                <th>key</th>
                <th>任务ID</th>
                {#            <th>value</th>#}
                <th>任务名称</th>
            </tr>
            {% for k, v in unack.items %}
                {% get_celery_taskname v as body %}
                <tr>
                    <td>{{ k }}</td>
                    <td>{{ body.id }}</td>
                    {#                <td>{{ body }}</td>#}
                    {#                <td>{{ body.args }}</td>#}
                    <td>{{ body.kwargs.name }}</td>
                </tr>
            {% endfor %}
        </table>
    {% endif %}
    <p/>
    {% for k, v in final_queue.items %}

        {% if v|length > 0 %}
            <b>队列{{ k }} ： {{ v | length }}</b>
            <table>
                <tr>
                    <th>所属队列</th>
                    <th>任务ID</th>
                    {#                <th>value22</th>#}
                    <th>任务名称</th>
                </tr>
                {% for msg in v %}
                    {% get_celery_taskname2 msg as body %}
                    <tr>
                        <td>{{ k }}</td>
                        <td>{{ body.id }}</td>
                        {#                    <td>{{ body }}</td>#}
                        <td>{{ body.kwargs.name }}</td>
                    </tr>
                {% endfor %}
            </table>
        {% endif %}
    {% endfor %}
    <p/>
    执行中：<br/>
    {% for k, v in running.items %}
        {% if v|length > 0 %}

            <b>{{ k }} {{ v|length }}</b> <br/>
            <table>
                <tr>
                    <th>所属队列</th>
                    <th>任务ID</th>
                    {#                <th>value22</th>#}
                    <th>任务名称</th>
                </tr>
                {% for msg in v %}
                    <tr>
                        <td>{{ k }}</td>
                        <td>{{ msg.id }}</td>
                        {#                    <td>{{ body }}</td>#}
                        <td>{{ msg.kwargs.name }}</td>
                    </tr>
                {% endfor %}
            </table>
        {% endif %}
    {% endfor %}

{% endblock %}